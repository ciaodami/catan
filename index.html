<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Catan Ranking System</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    .form-section { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
    label { display: block; margin: 5px 0; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: center; }
  </style>
</head>
<body>
  <h1>Catan Ranking System</h1>

  <!-- Inserimento partita -->
  <div class="form-section">
    <h2>Inserisci partita</h2>
    <label>Data: <input type="date" id="match-date"></label>
    
    <label>Giocatore 1:
      <input type="text" id="player1" list="players-list" oninput="checkNewPlayer(this)">
      <input type="number" id="score1" min="0" placeholder="Punteggio">
    </label>
    <label>Giocatore 2:
      <input type="text" id="player2" list="players-list" oninput="checkNewPlayer(this)">
      <input type="number" id="score2" min="0" placeholder="Punteggio">
    </label>
    <label>Giocatore 3:
      <input type="text" id="player3" list="players-list" oninput="checkNewPlayer(this)">
      <input type="number" id="score3" min="0" placeholder="Punteggio">
    </label>
    <label>Giocatore 4:
      <input type="text" id="player4" list="players-list" oninput="checkNewPlayer(this)">
      <input type="number" id="score4" min="0" placeholder="Punteggio">
    </label>
    <datalist id="players-list"></datalist>

    <button onclick="addMatch()">Aggiungi Partita</button>
  </div>

  <!-- Classifica -->
  <h2>Classifica</h2>
  <table id="ranking-table">
    <thead>
      <tr><th>Nome</th><th>Rating</th><th>Partite</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Partite -->
  <h2>Partite giocate</h2>
  <table id="matches-table">
    <thead>
      <tr><th>Data</th><th>Giocatore</th><th>Punteggio</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
let players = []; // elenco dinamico
let matches = []; // archivio partite
let ratings = {}; // rating dei giocatori

function updatePlayerList(inputValue="") {
  const datalist = document.getElementById("players-list");
  datalist.innerHTML = "";

  players.forEach(p => {
    if (p.toLowerCase().includes(inputValue.toLowerCase())) {
      let option = document.createElement("option");
      option.value = p;
      datalist.appendChild(option);
    }
  });

  if (inputValue && !players.some(p => p.toLowerCase() === inputValue.toLowerCase())) {
    let option = document.createElement("option");
    option.value = `+ Aggiungi "${inputValue}"`;
    datalist.appendChild(option);
  }
}

function checkNewPlayer(input) {
  updatePlayerList(input.value);

  if (input.value.startsWith("+ Aggiungi")) {
    let newName = input.value.match(/"(.*)"/)[1];
    players.push(newName);
    if (!ratings[newName]) ratings[newName] = 1000; // rating iniziale
    input.value = newName;
    updatePlayerList();
    updateRankingTable();
  }
}

function addMatch() {
  let date = document.getElementById("match-date").value;
  let gamePlayers = [
    {name: document.getElementById("player1").value, score: parseInt(document.getElementById("score1").value)||0},
    {name: document.getElementById("player2").value, score: parseInt(document.getElementById("score2").value)||0},
    {name: document.getElementById("player3").value, score: parseInt(document.getElementById("score3").value)||0},
    {name: document.getElementById("player4").value, score: parseInt(document.getElementById("score4").value)||0},
  ].filter(p => p.name);

  if (gamePlayers.length < 2) {
    alert("Inserisci almeno 2 giocatori.");
    return;
  }

  // aggiungi giocatori nuovi se non giÃ  presenti
  gamePlayers.forEach(p => {
    if (!players.includes(p.name)) {
      players.push(p.name);
      if (!ratings[p.name]) ratings[p.name] = 1000;
    }
  });

  matches.push({date, players: gamePlayers});
  updateMatchesTable();
  updateRankingTable();

  // reset form
  document.querySelectorAll("input[type=text], input[type=number]").forEach(el => el.value = "");
  document.getElementById("match-date").value = "";
}

function updateRankingTable() {
  let tbody = document.querySelector("#ranking-table tbody");
  tbody.innerHTML = "";

  // conteggio partite giocate
  let gamesCount = {};
  players.forEach(p => gamesCount[p] = 0);
  matches.forEach(m => m.players.forEach(p => gamesCount[p.name]++));

  players.forEach(p => {
    let tr = document.createElement("tr");
    tr.innerHTML = `<td>${p}</td><td>${ratings[p]}</td><td>${gamesCount[p] || 0}</td>`;
    tbody.appendChild(tr);
  });
}

function updateMatchesTable() {
  let tbody = document.querySelector("#matches-table tbody");
  tbody.innerHTML = "";
  matches.forEach(m => {
    m.players.forEach(p => {
      let tr = document.createElement("tr");
      tr.innerHTML = `<td>${m.date}</td><td>${p.name}</td><td>${p.score}</td>`;
      tbody.appendChild(tr);
    });
  });
}
</script>
</body>
</html>
